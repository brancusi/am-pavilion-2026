const fs = require("fs");
const path = require("path");

// Read the manifest.edn file generated by Shadow CLJS
const manifestPath = path.join(__dirname, "../release/js/manifest.edn");
const htmlPath = path.join(__dirname, "../public/index.html");
const outputHtmlPath = path.join(__dirname, "../release/index.html");

// Parse manifest.edn to get the hashed filename
const manifest = fs.readFileSync(manifestPath, "utf8");
const match = manifest.match(/:output-name\s+"([^"]+)"/);
const hashedFilename = match ? match[1] : "app.js";

// Read and update HTML
let html = fs.readFileSync(htmlPath, "utf8");
html = html.replace("/js/app.js", `/js/${hashedFilename}`);

// Write updated HTML
fs.writeFileSync(outputHtmlPath, html);
console.log(`Updated HTML with hashed filename: ${hashedFilename}`);
